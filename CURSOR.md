# Cursor AI Development Instructions

This document provides instructions for AI-assisted development using Cursor IDE for the ibl.ai SDK project.

## Project Overview

**ibl.ai SDK** is a TypeScript monorepo containing packages for building AI-powered educational applications. It consists of:

- `@iblai/iblai-js` - Unified package containing data layer, utilities, and React components
  - Includes `data-layer/` - RTK Query API slices and data management
  - Includes `web-utils/` - React providers, hooks, and utilities
  - Includes `web-containers/` - Reusable React UI components

## Technology Stack

- **Language**: TypeScript 5.8+
- **Package Manager**: pnpm 10.11.0
- **Monorepo Tool**: Turborepo 2.5+
- **Build Tool**: Rollup
- **Testing**: Vitest
- **State Management**: Redux Toolkit (RTK Query)
- **UI Framework**: React 19+

## Development Workflow

### Initial Setup

When working on this project for the first time:

1. Verify Node.js >= 18 and pnpm >= 9 are installed
2. Run `pnpm install` to install dependencies
3. Run `pnpm build` to build all packages
4. Run `pnpm test` to verify setup

### Common Commands

```bash
# Build all packages
pnpm build

# Watch mode for development
pnpm watch
pnpm watch:data-layer      # Watch specific package
pnpm watch:web-utils
pnpm watch:web-containers

# Testing
pnpm test                  # Run all tests
pnpm test:watch           # Watch mode
pnpm test:coverage        # Coverage report

# Code quality
pnpm lint                 # Run ESLint
pnpm lint:fix            # Auto-fix issues
pnpm typecheck           # Type checking
pnpm format              # Format code
```

## Code Style Guidelines

### TypeScript

**DO:**
```typescript
// Proper type definitions
interface MentorData {
  id: string;
  name: string;
  settings: MentorSettings;
}

// Explicit return types for functions
function getMentor(id: string): Promise<MentorData> {
  // implementation
}
```

**DON'T:**
```typescript
// Avoid 'any' types
function getData(): any { } // ❌

// Missing return types
function processData(data) { } // ❌
```

### React Components

**DO:**
```typescript
// Functional components with TypeScript
interface ButtonProps {
  onClick: () => void;
  children: React.ReactNode;
  variant?: 'primary' | 'secondary';
}

export function Button({ onClick, children, variant = 'primary' }: ButtonProps) {
  return <button onClick={onClick} className={variant}>{children}</button>;
}
```

**DON'T:**
```typescript
// Untyped props
export function Button(props) { } // ❌

// Default exports for components
export default function Button() { } // ❌ (use named exports)
```

### File Organization

```
packages/[package-name]/
├── src/
│   ├── features/          # Feature-based modules
│   ├── components/        # React components
│   ├── hooks/             # Custom hooks
│   ├── providers/         # Context providers
│   ├── utils/             # Utility functions
│   ├── types/             # TypeScript types
│   └── index.ts           # Main export
├── __tests__/             # Test files (alternative location)
├── package.json
└── rollup.config.js
```

### Naming Conventions

| Type | Convention | Example |
|------|-----------|---------|
| Files | kebab-case | `use-auth-hook.ts` |
| Components | PascalCase | `AuthProvider.tsx` |
| Functions | camelCase | `getUserData()` |
| Constants | UPPER_SNAKE_CASE | `API_BASE_URL` |
| Types/Interfaces | PascalCase | `UserData`, `ApiResponse` |
| Hooks | camelCase with `use` prefix | `useAuth`, `useMentor` |

## Package-Specific Guidelines

### @iblai/data-layer

**Purpose**: RTK Query API slices and data management

**Key Files**:
- `src/features/*/api-slice.ts` - RTK Query API definitions
- `src/types/` - Shared type definitions
- `src/store.ts` - Redux store configuration

**When adding new API endpoints**:

1. Create or update the feature's api-slice.ts
2. Define TypeScript interfaces for request/response types
3. Use RTK Query's `builder` pattern
4. Export hooks (auto-generated by RTK Query)
5. Update the main `index.ts` to export new hooks

Example:
```typescript
// src/features/mentor/api-slice.ts
import { createApi } from '@reduxjs/toolkit/query/react';

export const mentorApi = createApi({
  reducerPath: 'mentorApi',
  baseQuery: fetchBaseQuery({ baseUrl: '/api' }),
  endpoints: (builder) => ({
    getMentors: builder.query<MentorResponse, MentorRequest>({
      query: ({ org, limit }) => `mentors?org=${org}&limit=${limit}`,
    }),
  }),
});

export const { useGetMentorsQuery } = mentorApi;
```

### @iblai/web-utils

**Purpose**: Providers, hooks, and utility functions

**Key Files**:
- `src/providers/` - React context providers
- `src/hooks/` - Custom React hooks
- `src/utils/` - Pure utility functions

**When adding providers**:

1. Create provider file in `src/providers/`
2. Define context interface
3. Export both provider and hook
4. Document usage in JSDoc
5. Update index.ts

Example:
```typescript
// src/providers/auth-provider.tsx
interface AuthContextValue {
  user: User | null;
  login: (credentials: Credentials) => Promise<void>;
  logout: () => void;
}

const AuthContext = createContext<AuthContextValue | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  // implementation
  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

### @iblai/web-containers

**Purpose**: Reusable React UI components

**Key Files**:
- `src/components/` - Component files
- `src/hooks/` - Component-specific hooks

**When adding components**:

1. Create component file with `.tsx` extension
2. Define prop interface
3. Include JSDoc documentation
4. Export as named export
5. Add Storybook stories (if applicable)
6. Update index.ts

Example:
```typescript
// src/components/modal.tsx
/**
 * Modal component for displaying content in an overlay
 */
interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

export function Modal({ isOpen, onClose, title, children }: ModalProps) {
  if (!isOpen) return null;
  // implementation
}
```

## Testing Guidelines

### Test Structure

```typescript
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';

describe('ComponentName', () => {
  it('should render correctly', () => {
    // Arrange
    const props = { /* test props */ };

    // Act
    render(<ComponentName {...props} />);

    // Assert
    expect(screen.getByText('Expected Text')).toBeInTheDocument();
  });
});
```

### Testing Hooks

```typescript
import { renderHook, act } from '@testing-library/react';

describe('useCustomHook', () => {
  it('should return expected value', () => {
    const { result } = renderHook(() => useCustomHook());

    act(() => {
      result.current.doSomething();
    });

    expect(result.current.value).toBe('expected');
  });
});
```

## Making Changes

### Adding a New Feature

1. Identify which package(s) need changes
2. Create feature branch: `git checkout -b feature/my-feature`
3. Make changes following code style guidelines
4. Add/update tests
5. Run `pnpm typecheck` and `pnpm lint`
6. Run `pnpm test` to ensure all tests pass
7. Create changeset: `pnpm changeset`
8. Commit with conventional commit message

### Fixing a Bug

1. Create bug fix branch: `git checkout -b fix/bug-description`
2. Write a failing test that reproduces the bug
3. Fix the bug
4. Verify test now passes
5. Run full test suite
6. Create changeset
7. Commit changes

### Commit Message Format

Follow [Conventional Commits](https://www.conventionalcommits.org/):

```
type(scope): description

[optional body]

[optional footer]
```

Types:
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `refactor`: Code refactoring
- `test`: Adding/updating tests
- `chore`: Maintenance tasks

Examples:
```
feat(data-layer): add getMentors query hook
fix(web-utils): correct auth token refresh logic
docs(readme): update installation instructions
refactor(web-containers): simplify modal component
```

## Common Patterns

### Creating API Hooks (RTK Query)

```typescript
// In data-layer package
export const apiSlice = createApi({
  endpoints: (builder) => ({
    getResource: builder.query<Response, Request>({
      query: (params) => `endpoint/${params.id}`,
      transformResponse: (response) => response.data,
    }),
    updateResource: builder.mutation<Response, UpdateRequest>({
      query: ({ id, ...patch }) => ({
        url: `endpoint/${id}`,
        method: 'PATCH',
        body: patch,
      }),
    }),
  }),
});
```

### Creating Context Providers

```typescript
// In web-utils package
const Context = createContext<ContextValue | undefined>(undefined);

export function Provider({ children }: { children: React.ReactNode }) {
  const [state, setState] = useState<State>(initialState);

  const value = useMemo(() => ({
    state,
    actions: {
      doSomething: () => setState(newState),
    },
  }), [state]);

  return <Context.Provider value={value}>{children}</Context.Provider>;
}

export function useContext() {
  const context = useContext(Context);
  if (!context) throw new Error('useContext must be used within Provider');
  return context;
}
```

## Troubleshooting

### Build Issues

```bash
# Clear all build artifacts
pnpm clean

# Rebuild everything
pnpm build
```

### Dependency Issues

```bash
# Remove node_modules and reinstall
rm -rf node_modules
pnpm install
```

### Type Errors

```bash
# Run type checking with detailed output
pnpm typecheck
```

## AI Assistant Guidelines

When helping with this project:

1. **Always use TypeScript** - Provide properly typed code
2. **Follow existing patterns** - Match the coding style of surrounding code
3. **Include tests** - Provide test cases for new features
4. **Document changes** - Add JSDoc comments for public APIs
5. **Check dependencies** - Ensure proper peer dependencies
6. **Update exports** - Don't forget to update index.ts files
7. **Consider performance** - Use useMemo, useCallback where appropriate
8. **Maintain backwards compatibility** - Avoid breaking changes when possible

## Resources

- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/)
- [React Documentation](https://react.dev)
- [RTK Query](https://redux-toolkit.js.org/rtk-query/overview)
- [Turborepo Docs](https://turbo.build/repo/docs)
- [Vitest Documentation](https://vitest.dev)
